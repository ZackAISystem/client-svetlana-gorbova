{{ $c := site.Data.client }}
{{ $projectName := .Title }}

<section class="contact-section" id="inquire">
  <div class="contact-wrap">
    <div class="contact-inner">

      <h2 class="contact-title">Inquire Now</h2>

      <!-- FORM -->
      <form class="contact-form" id="contactForm">

        <!-- hidden meta -->
        <input type="hidden" name="source" value="coccinelite.com">
        <input type="hidden" name="agent" value="{{ $c.name }}">

        <div class="field">
          <input
            type="text"
            name="name"
            placeholder="Enter Your Name"
            autocomplete="name"
            required
          >
        </div>

        <div class="field">
          <input
            type="tel"
            name="phone"
            placeholder="Enter Your Phone"
            autocomplete="tel"
            required
          >
        </div>

        <div class="field field-select">
          <select id="roleSelect" name="role" required>
            <option value="Real Estate Agent">Real Estate Agent</option>
            <option value="Investor" selected>Investor</option>
            <option value="Homebuyer">Homebuyer</option>
          </select>
        </div>

        <div class="field">
          <textarea
            name="comments"
            placeholder="Enter Your Comments"
            rows="6"
          ></textarea>
        </div>

        <button class="contact-submit" type="submit">
          Submit
        </button>

      </form>

    </div>
  </div>
</section>

<!-- FORM → WHATSAPP -->
<script>
document.getElementById("contactForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const name = this.querySelector('[name="name"]').value.trim();
  const phone = this.querySelector('[name="phone"]').value.trim();
  const role = this.querySelector('[name="role"]').value;
  const comments = this.querySelector('[name="comments"]').value.trim();

  // безопасно пробрасываем заголовок страницы (не ломается от кавычек)
  const project = {{ $projectName | jsonify }};

  // ВАЖНО: реальный URL из браузера (в проде будет coccinelite.com)
  const pageUrl = window.location.href;

  const message =
`New inquiry from main website

Client type: ${role}
Name: ${name}
Phone: ${phone}

Project: ${project}
Page: ${pageUrl}

Comment:
${comments || "-"}

Please contact the client.`;

  const encoded = encodeURIComponent(message);

  // номер берём из client data, чтобы не хардкодить
  const waBase = "{{ $c.whatsapp_link }}"; // например: https://wa.me/971558869299
  const waLink = waBase + "?text=" + encoded;

  window.open(waLink, "_blank");
});
</script>

<!-- ROLE AUTOSELECT SCRIPT -->
<script>
  document.addEventListener("click", function (e) {
    const btn = e.target.closest("[data-role]");
    if (!btn) return;

    const role = btn.getAttribute("data-role");
    const select = document.getElementById("roleSelect");
    if (!select) return;

    select.value = role;
  });
</script>
